<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Sales TV (Screenshots)</title>
  <style>
    html, body { margin:0; height:100%; background:#000; overflow:hidden; }

    img {
      position: fixed;
      top: 0; left: 0;
      width: 100%;
      height: 100%;
      object-fit: contain; /* change to cover if you want full screen */
      background: #000;
      opacity: 0;
      transition: opacity 250ms linear;
    }
    img.show { opacity: 1; }

    #err {
      position: fixed; inset: 0;
      display:none;
      align-items:center; justify-content:center;
      color:#fff; font: 20px Arial;
      padding: 40px; text-align:center;
      background:#000;
    }
  </style>
</head>
<body>
  <div id="err"></div>
  <img id="a" class="show" />
  <img id="b" />

  <script>
    // ✅ Slide switch every 2 minutes
    const SLIDE_MS = 2 * 60 * 1000; // 120000

    const a = document.getElementById("a");
    const b = document.getElementById("b");
    const err = document.getElementById("err");

    let slides = [];
    let idx = 0;
    let activeIsA = true;

    function hidden() { return activeIsA ? b : a; }

    function swapVisible() {
      activeIsA = !activeIsA;
      a.classList.toggle("show", activeIsA);
      b.classList.toggle("show", !activeIsA);
    }

    function showError(msg) {
      err.style.display = "flex";
      err.textContent = msg;
    }

    async function loadManifest() {
      const res = await fetch("shots/manifest.json?cb=" + Date.now());
      if (!res.ok) throw new Error("Cannot load shots/manifest.json (HTTP " + res.status + ")");
      return res.json();
    }

    function setImg(img, file) {
      // ✅ cache-bust so the TV fetches the newest image after each screenshot update run
      img.src = file + "?cb=" + Date.now();
    }

    function preloadNext() {
      const next = (idx + 1) % slides.length;
      setImg(hidden(), slides[next].file);
    }

    function nextSlide() {
      idx = (idx + 1) % slides.length;
      swapVisible();
      preloadNext();
    }

    (async () => {
      try {
        slides = await loadManifest();
        if (!slides.length) throw new Error("Manifest loaded but contains 0 slides.");

        // initial
        setImg(a, slides[0].file);
        setImg(b, slides[1 % slides.length].file);

        setInterval(nextSlide, SLIDE_MS);
      } catch (e) {
        showError(String(e));
      }
    })();
  </script>
</body>
</html>
